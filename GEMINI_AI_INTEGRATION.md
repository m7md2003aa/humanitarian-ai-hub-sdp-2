# Google Gemini AI Integration - Clothing Donation Scanner

## Overview
Successfully integrated Google Gemini AI (gemini-2.0-flash-exp) for automatic clothing item classification and analysis in the donation upload flow. Added comprehensive cloth type selection and filtering system for better item organization.

## What Was Implemented

### 1. **Environment Configuration**
- Added `EXPO_PUBLIC_GEMINI_API_KEY` to `.env` file
- API Key: `AIzaSyBNEfCwBUBtqZ02F-0UV82zlMIHBXQteug`

### 2. **Package Installation**
- Installed `@google/generative-ai` SDK version 0.24.1

### 3. **Type Definitions** (`src/types/donations.ts`)
Added new types and fields:
- **ClothType**: Enum with 16 clothing types (T-Shirt, Shirt, Pants, Jeans, Jacket, Coat, Dress, Skirt, Sweater, Hoodie, Shorts, Shoes, Socks, Underwear, Accessories, Other)
- **Donation interface**: Added `clothType?`, `size?`, `color?` fields
- **ItemListing interface**: Added `clothType?`, `size?`, `color?` fields

### 4. **AI Classification Service** (`src/utils/aiClassification.ts`)
Enhanced the service with the following features:

#### Automatic Image Analysis:
- **Title Generation**: AI generates descriptive titles (e.g., "Blue Denim Jacket", "Red Cotton T-Shirt")
- **Category Detection**: Classifies items as "clothing" or "other"
- **Detailed Classification**:
  - **Cloth Type**: Identifies specific clothing types (T-shirt, Jeans, Jacket, Dress, Sweater, Shoes, etc.)
  - **Size**: Estimates size (Small, Medium, Large, XL, Kids, Adult)
  - **Color**: Detects primary colors (Blue, Red, Black, Multi-color)
- **Confidence Score**: Provides AI confidence level (0-1)

#### Features:
- Uses base64 image encoding for Gemini API
- JSON-based response parsing
- Fallback classification when API is unavailable
- Error handling with graceful degradation

### 5. **Updated Donation Upload Screen** (`src/screens/donor/DonationUpload.tsx`)

#### New State Variables:
```typescript
const [selectedClothType, setSelectedClothType] = useState<ClothType | null>(null);
const [size, setSize] = useState('');
const [color, setColor] = useState('');
```

#### Auto-Analysis Flow:
1. User takes a photo or selects from gallery
2. AI automatically analyzes the image (triggered by `analyzeCapturedImage()`)
3. Form fields are auto-filled with AI results:
   - **Title**: Generated by AI
   - **Category**: Detected category
   - **Cloth Type**: Auto-selected from dropdown (normalized to match enum)
   - **Size**: Auto-filled
   - **Color**: Auto-filled

#### New UI Components:
- **Cloth Type Selector**: Horizontal scrollable list of 16 clothing types (only visible when category is "clothing")
- **Size Input**: Text field for size (auto-filled by AI, editable)
- **Color Input**: Text field for color (auto-filled by AI, editable)
- **Validation**: Submit button disabled if cloth type not selected when category is clothing

#### UI Enhancements:
- **Loading Indicator**: Shows "AI is analyzing your image..." during processing
- **Results Display**: Shows AI analysis results with checkmark icon:
  - Type: [cloth type]
  - Color: [detected color]
  - Size: [estimated size]
- **Disabled Continue Button**: Prevents navigation while AI is analyzing
- **Reset Functionality**: Clears all AI details when removing photo

### 6. **Updated Beneficiary Browser Screen** (`src/screens/beneficiary/ItemBrowser.tsx`)

#### New Filtering System:
- **Cloth Type Filter**: Horizontal scrollable list appears when "Clothing" category or "All Items" is selected
- **Filter Logic**: Items filtered by both category AND cloth type
- **Smart Reset**: Cloth type filter resets when switching to non-clothing categories
- **Visual Design**: Cloth type filters use green/success color to distinguish from category filters (blue/primary)

#### User Experience:
1. Browse all items or filter by category (Clothing/Other)
2. When viewing clothing items, additional cloth type filter appears
3. Select specific types (T-Shirt, Jeans, etc.) to narrow results
4. Search bar works across all filters
5. Each item card displays cloth type, size, and color information

## How It Works

### Donor Flow:
1. Navigate to Donation Upload screen
2. Take a photo or select from gallery
3. **AI automatically analyzes the image** (new!)
4. View AI analysis results on screen
5. Review/edit auto-filled fields:
   - Title
   - Cloth Type (required for clothing)
   - Size
   - Color
   - Description
6. Submit donation

### Beneficiary Flow:
1. Navigate to Browse Items screen
2. See all available items
3. Filter by category (Clothing/Other)
4. **Filter by cloth type** (T-Shirt, Jeans, Jacket, etc.) - new!
5. Search by keywords
6. View item details including cloth type, size, and color
7. Claim items using credits

### Technical Flow:
```
Image Captured
  ‚Üí Read as Base64
  ‚Üí Send to Gemini API with structured prompt
  ‚Üí Parse JSON response
  ‚Üí Extract: title, category, clothType, size, color, confidence
  ‚Üí Normalize cloth type to match enum
  ‚Üí Auto-fill form fields
  ‚Üí Display results to user
  ‚Üí User can edit before submitting
  ‚Üí Data saved with all metadata
  ‚Üí Beneficiaries can filter by cloth type
```

## API Usage

### Gemini API Request:
- **Model**: `gemini-2.0-flash-exp`
- **Input**: Base64-encoded JPEG image
- **Prompt**: Structured JSON request for classification details
- **Output**: JSON with title, category, clothType, size, color, confidence

### Response Format:
```json
{
  "category": "clothing",
  "title": "Blue Denim Jacket",
  "clothType": "Jacket",
  "size": "Medium",
  "color": "Blue",
  "confidence": 0.92
}
```

## Testing

To test the integration:
1. Open the app in the Vibecode mobile app
2. Log in as a donor account
3. Navigate to "Upload Donation"
4. Take/select a photo of clothing
5. Watch for the AI analyzing indicator
6. Verify all fields populate correctly (title, cloth type, size, color)
7. Edit fields if needed
8. Submit donation
9. Log in as beneficiary account
10. Browse items and test cloth type filters
11. Verify filtering works correctly

### Expected Log Output:
```
üîç Analyzing image with Gemini...
‚úÖ AI Classification Result: {category: 'clothing', title: '...', clothType: '...', size: '...', color: '...'}
```

## Files Modified

1. `.env` - Added Gemini API key
2. `package.json` - Added @google/generative-ai dependency
3. `src/types/donations.ts` - Added ClothType enum and fields to Donation/ItemListing interfaces
4. `src/utils/aiClassification.ts` - Complete rewrite with Gemini integration
5. `src/screens/donor/DonationUpload.tsx` - Added auto-analysis, cloth type selector, size/color fields
6. `src/screens/beneficiary/ItemBrowser.tsx` - Added cloth type filtering UI and logic

## Benefits

‚úÖ **Automatic item classification** - No manual data entry needed
‚úÖ **Accurate descriptions** - AI-generated titles and details
‚úÖ **Better categorization** - Precise cloth type identification with 16 categories
‚úÖ **Size estimation** - Helpful for donors and beneficiaries
‚úÖ **Color detection** - Improved searchability
‚úÖ **User-friendly** - Instant results with clear feedback
‚úÖ **Advanced filtering** - Beneficiaries can filter by specific cloth types
‚úÖ **Organized browsing** - Easy to find specific items (e.g., just T-shirts or just Jeans)
‚úÖ **Scalable** - Easy to add more cloth types in the future

## Cloth Types Available

The system supports 16 clothing types:
1. T-Shirt
2. Shirt
3. Pants
4. Jeans
5. Jacket
6. Coat
7. Dress
8. Skirt
9. Sweater
10. Hoodie
11. Shorts
12. Shoes
13. Socks
14. Underwear
15. Accessories
16. Other

## Future Enhancements

Potential improvements:
- Multi-language support for titles/descriptions
- Brand detection
- Condition assessment (excellent, good, fair)
- Material detection (cotton, polyester, wool, etc.)
- Pattern recognition (striped, plaid, solid, etc.)
- Multiple item detection in single image
- Gender classification (Men's, Women's, Unisex)
- Season appropriateness (Winter, Summer, All-season)
- Occasion tags (Casual, Formal, Athletic)

---

**Integration completed successfully!** The scanning functionality now automatically fills the title, category, cloth type, size, and color. Beneficiaries can filter items by specific cloth types to find exactly what they need.
